<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Final</title>

<style>
/* ===== å…¨ä½“ ===== */
body{
  margin:0;
  min-height:100vh;
  background:#f3f4f6;
  color:#111;
  font-family:system-ui, sans-serif;

  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;

  gap:24px;
  text-align:center;              /* âœ… æ–‡å­—ã‚‚ä¸­å¤® */
}

/* âœ… æœ€çµ‚ãƒšãƒ¼ã‚¸ã®ä¸­å¤®æƒãˆã‚’å¼·åˆ¶ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ */
.container{
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:24px;
}

/* ===== ã‚«ãƒ¼ãƒ‰ ===== */
.box{
  width:90%;
  max-width:420px;
  background:#fff;
  border-radius:20px;
  padding:20px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
  text-align:center;
}

/* ===== çµµæ–‡å­—ã‚¿ãƒ– ===== */
.emoji-tabs{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;         /* âœ… çµµæ–‡å­—ã¯ä¸­å¤® */
  gap:14px;
  margin-top:12px;
}

.emoji-btn{
  font-size:32px;
  width:64px;
  height:64px;
  border-radius:16px;
  border:1px solid #ddd;
  background:#f8f8f8;
  color:#111;
}

.emoji-btn.selected{
  background:#e5e7eb;
  border-color:#999;
}

/* ===== ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ ===== */
button.main{
  width:90%;
  max-width:420px;
  height:72px;
  font-size:24px;
  border-radius:20px;
  border:none;
  background:#111827;
  color:#fff;
}

/* ===== è¡¨ç¤ºåˆ‡æ›¿ ===== */
.hidden{ display:none; }

video{
  width:92%;
  max-width:520px;
  margin-top:18px;
  border-radius:16px;
}

/* ===== ç´™å¹é›ªï¼ˆç°¡æ˜“ï¼‰ ===== */
.confetti-layer{
  position:fixed;
  inset:0;
  pointer-events:none;
  overflow:hidden;
  z-index:9999;
}

.confetti{
  position:absolute;
  top:-12px;
  width:10px;
  height:14px;
  opacity:0.95;
  border-radius:2px;
  animation: fall linear forwards;
}

@keyframes fall{
  to{
    transform: translate(var(--dx), 110vh) rotate(var(--rot));
  }
}
</style>
</head>

<body>

<div class="container">

  <!-- ç´™å¹é›ªãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
  <div id="confettiLayer" class="confetti-layer hidden"></div>

  <div id="puzzleArea">
    <div class="box">
      <div style="font-weight:600;">ã²ã¨ã¤ç›®</div>
      <div class="emoji-tabs" id="box1"></div>
    </div>

    <div class="box">
      <div style="font-weight:600;">ãµãŸã¤ç›®</div>
      <div class="emoji-tabs" id="box2"></div>
    </div>

    <button class="main" onclick="checkAnswer()">å›ç­”</button>
  </div>

  <div id="clearArea" class="hidden">
    <div class="box">
      <div style="font-size:20px; line-height:1.6; font-weight:600;">
        ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼<br>
        ã‚ªãƒ¼ã¡ã‚ƒã‚“ã®ç§˜è”µæ˜ åƒã‚’å·®ã—ä¸Šã’ã¾ã™ï¼
      </div>
    </div>

    <button class="main" onclick="playFinalVideo()">ç§˜è”µæ˜ åƒã‚’å†ç”Ÿ</button>

    <video id="finalVideo" class="hidden" controls>
      <source src="IMG_4487.mov" type="video/quicktime">
    </video>
  </div>

</div>

<script>
// =======================
// Audio
// =======================
let audioCtx;
function getCtx(){
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if(audioCtx.state === "suspended") audioCtx.resume();
  return audioCtx;
}

function playMissSound(){
  const ctx = getCtx();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.type = "sawtooth";
  osc.frequency.setValueAtTime(220, ctx.currentTime);

  gain.gain.setValueAtTime(0.25, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.35);

  osc.connect(gain); gain.connect(ctx.destination);
  osc.start(); osc.stop(ctx.currentTime + 0.35);
}

// æˆåŠŸéŸ³ï¼ˆå‰ã¨åŒã˜æœ€é«˜éŸ³ï¼‰
function playSuccessSound(){
  const ctx = getCtx();
  const o1 = ctx.createOscillator();
  const o2 = ctx.createOscillator();
  const gain = ctx.createGain();

  o1.type = "triangle";
  o2.type = "sine";
  o1.frequency.value = 880;
  o2.frequency.value = 1320;

  gain.gain.setValueAtTime(0.001, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.05);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.8);

  o1.connect(gain); o2.connect(gain); gain.connect(ctx.destination);
  o1.start(); o2.start();
  o1.stop(ctx.currentTime + 0.8);
  o2.stop(ctx.currentTime + 0.8);
}

// =======================
// çµµæ–‡å­—æš—å·ï¼ˆãƒ€ãƒŸãƒ¼è¢«ã‚Šãªã—ï¼‰
// =======================
const correct1 = "ğŸ§³";
const correct2 = "ğŸ¢";

const dummyPool = ["ğŸ","ğŸˆ","ğŸ¸","ğŸš²","ğŸª","ğŸ“¦","ğŸ¦·","ğŸ‹","ğŸ®","ğŸ§¤","ğŸ§¸","ğŸ§¯","ğŸª‘","ğŸª™","ğŸ§ª","ğŸ§©"];
let select1 = null;
let select2 = null;

function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }

function makeDistinctDummies(nEach){
  const pool = dummyPool.filter(e => e !== correct1 && e !== correct2);
  const picked = shuffle(pool).slice(0, nEach*2);
  return { d1: picked.slice(0,nEach), d2: picked.slice(nEach,nEach*2) };
}
const { d1, d2 } = makeDistinctDummies(4);

function fillBox(elemId, correct, dummies, setter){
  const box = document.getElementById(elemId);
  const list = shuffle([correct, ...dummies]);

  list.forEach(emoji=>{
    const btn = document.createElement("button");
    btn.className = "emoji-btn";
    btn.textContent = emoji;
    btn.onclick = ()=>{
      getCtx();
      [...box.children].forEach(b=>b.classList.remove("selected"));
      btn.classList.add("selected");
      setter(emoji);
    };
    box.appendChild(btn);
  });
}
fillBox("box1", correct1, d1, e=>select1=e);
fillBox("box2", correct2, d2, e=>select2=e);

// =======================
// ç´™å¹é›ªï¼ˆè»½é‡ï¼‰
// =======================
function launchConfetti(){
  const layer = document.getElementById("confettiLayer");
  layer.classList.remove("hidden");
  layer.innerHTML = "";

  const pieces = 70; // é‡ï¼ˆå¥½ã¿ã§å¢—æ¸›OKï¼‰
  for(let i=0;i<pieces;i++){
    const p = document.createElement("div");
    p.className = "confetti";

    const left = Math.random() * 100;
    const dx = (Math.random()*2 - 1) * 80;  // æ¨ªæºã‚Œ
    const rot = (Math.random()*2 - 1) * 720; // å›è»¢
    const dur = 2.2 + Math.random()*1.6;

    p.style.left = left + "vw";
    p.style.setProperty("--dx", dx + "px");
    p.style.setProperty("--rot", rot + "deg");
    p.style.animationDuration = dur + "s";

    // è‰²ã¯ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆæ˜ã‚‹ã‚ï¼‰
    const colors = ["#fb7185","#fbbf24","#34d399","#60a5fa","#a78bfa","#f472b6"];
    p.style.background = colors[Math.floor(Math.random()*colors.length)];

    layer.appendChild(p);
  }

  // ã—ã°ã‚‰ãã—ãŸã‚‰æ¶ˆã™
  setTimeout(()=> {
    layer.classList.add("hidden");
    layer.innerHTML = "";
  }, 3800);
}

// =======================
// åˆ¤å®š
// =======================
function checkAnswer(){
  getCtx();

  if(select1 === correct1 && select2 === correct2){
    try{ playSuccessSound(); }catch(e){}
    document.getElementById("puzzleArea").classList.add("hidden");
    document.getElementById("clearArea").classList.remove("hidden");

    // âœ… ã‚¯ãƒªã‚¢å¾Œã«ç´™å¹é›ª
    launchConfetti();
  }else{
    try{ playMissSound(); }catch(e){}
  }
}

function playFinalVideo(){
  const v = document.getElementById("finalVideo");
  v.classList.remove("hidden");
  v.currentTime = 0;
  v.play();
}
</script>

</body>
</html>
