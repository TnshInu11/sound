<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Final Secret</title>

<style>
body {
  margin: 0;
  min-height: 100vh;
  background: #0b0b0b;
  color: white;
  font-family: system-ui, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 24px;
}

.box {
  width: 90%;
  max-width: 420px;
  background: #1a1a1a;
  border-radius: 20px;
  padding: 20px;
  text-align: center;
}

.emoji-tabs {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 14px;
  margin-top: 12px;
}

.emoji-btn {
  font-size: 32px;
  width: 64px;
  height: 64px;
  border-radius: 16px;
  border: none;
  background: #333;
  color: white;
}

.emoji-btn.selected {
  background: #666;
}

button.main {
  width: 90%;
  max-width: 420px;
  height: 72px;
  font-size: 24px;
  border-radius: 20px;
  border: none;
  background: #444;
  color: white;
}

.hidden {
  display: none;
}

video {
  width: 92%;
  max-width: 520px;
  margin-top: 20px;
}
</style>
</head>

<body>

<!-- æš—å·ã‚¨ãƒªã‚¢ -->
<div id="puzzleArea">
  <div class="box">
    <div>ã²ã¨ã¤ç›®</div>
    <div class="emoji-tabs" id="box1"></div>
  </div>

  <div class="box">
    <div>ãµãŸã¤ç›®</div>
    <div class="emoji-tabs" id="box2"></div>
  </div>

  <button class="main" onclick="checkAnswer()">å›ç­”</button>
</div>

<!-- ã‚¯ãƒªã‚¢ç”»é¢ -->
<div id="clearArea" class="hidden">
  <div class="box">
    <div style="font-size:20px; line-height:1.5;">
      ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼<br>
      ã‚ªãƒ¼ã¡ã‚ƒã‚“ã®ç§˜è”µæ˜ åƒã‚’å·®ã—ä¸Šã’ã¾ã™ï¼
    </div>
  </div>

  <button class="main" onclick="playFinalVideo()">ç§˜è”µæ˜ åƒã‚’å†ç”Ÿ</button>

  <video id="finalVideo" class="hidden" controls>
    <source src="IMG_4487.mov" type="video/quicktime">
  </video>
</div>

<script>
// =======================
// Audio
// =======================
let audioCtx;
function getCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === 'suspended') audioCtx.resume();
  return audioCtx;
}

function playMissSound() {
  const ctx = getCtx();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();

  osc.type = 'sawtooth';
  osc.frequency.setValueAtTime(220, ctx.currentTime);
  gain.gain.setValueAtTime(0.25, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);

  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime + 0.4);
}

function playSuccessSound() {
  const ctx = getCtx();
  const o1 = ctx.createOscillator();
  const o2 = ctx.createOscillator();
  const gain = ctx.createGain();

  o1.type = 'triangle';
  o2.type = 'sine';
  o1.frequency.value = 880;
  o2.frequency.value = 1320;

  gain.gain.setValueAtTime(0.001, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.05);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.8);

  o1.connect(gain);
  o2.connect(gain);
  gain.connect(ctx.destination);

  o1.start();
  o2.start();
  o1.stop(ctx.currentTime + 0.8);
  o2.stop(ctx.currentTime + 0.8);
}

// =======================
// Emoji logic
// =======================
const correct1 = 'ğŸ§³';
const correct2 = 'ğŸ¢';

const dummyEmojis = ['ğŸ','ğŸˆ','ğŸ¸','ğŸš²','ğŸª','ğŸ“¦','ğŸ¦·','ğŸ‹'];

let select1 = null;
let select2 = null;

function createBox(id, correct, selectFunc) {
  const box = document.getElementById(id);
  const list = [correct];

  while (list.length < 5) {
    const e = dummyEmojis[Math.floor(Math.random() * dummyEmojis.length)];
    if (!list.includes(e)) list.push(e);
  }

  list.sort(() => Math.random() - 0.5);

  list.forEach(emoji => {
    const btn = document.createElement('button');
    btn.className = 'emoji-btn';
    btn.textContent = emoji;
    btn.onclick = () => {
      [...box.children].forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      selectFunc(emoji);
    };
    box.appendChild(btn);
  });
}

createBox('box1', correct1, e => select1 = e);
createBox('box2', correct2, e => select2 = e);

// =======================
// åˆ¤å®š
// =======================
function checkAnswer() {
  getCtx();

  if (select1 === correct1 && select2 === correct2) {
    playSuccessSound();
    document.getElementById('puzzleArea').classList.add('hidden');
    document.getElementById('clearArea').classList.remove('hidden');
  } else {
    playMissSound();
  }
}

function playFinalVideo() {
  const v = document.getElementById('finalVideo');
  v.classList.remove('hidden');
  v.currentTime = 0;
  v.play();
}
</script>

</body>
</html>
